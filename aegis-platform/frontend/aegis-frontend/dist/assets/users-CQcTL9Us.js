import{r as n,ai as se,j as e,a0 as T,aj as M,ak as ae,G as te,H as O,X as le,L as re,al as q,am as $,J as ne,an as ie,_ as ce}from"./react-vendor-B391mDFM.js";import{D as B,l as H,m as K,n as Z,o as G,p as v,I as D,S as X,q as J,s as Y,t as Q,u as W,e as _,z as ee,B as o,E as z,T as de,L as oe,C as k,a as F,b as R,c as L,d as me}from"./assessments-CKARqxWC.js";import"./vendor-BAj2-sgi.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-D-EuUvUy.js";function ue({open:m,onOpenChange:N,onUserAdded:d}){const[u,w]=n.useState(!1),[j,i]=n.useState(null),{register:c,handleSubmit:y,reset:l,setValue:p,watch:x,formState:{errors:r}}=se({defaultValues:{full_name:"",email:"",username:"",password:"",role:"Read-Only User",is_active:!0}}),b=x("role"),h=()=>{l(),i(null),N(!1)},S=async t=>{w(!0),i(null);try{console.log("Creating user with data:",t),await z.create(t),console.log("✅ User created successfully:",t),d&&d(),h()}catch(f){console.error("❌ Failed to create user:",f),i(f.message||"Failed to create user. Please try again.")}finally{w(!1)}},C=t=>{if(t){const f=t.split("@")[0];p("username",f)}},U=[{value:"Admin",label:"Admin",description:"Full system access",color:"destructive"},{value:"Security Analyst",label:"Security Analyst",description:"Security operations",color:"default"},{value:"Risk Manager",label:"Risk Manager",description:"Risk management tasks",color:"secondary"},{value:"Compliance Officer",label:"Compliance Officer",description:"Compliance activities",color:"outline"},{value:"Read-Only User",label:"Read-Only User",description:"View only access",color:"secondary"}],g=U.find(t=>t.value===b);return e.jsx(B,{open:m,onOpenChange:N,children:e.jsxs(H,{className:"sm:max-w-[500px]",children:[e.jsxs(K,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Add New User"]}),e.jsx(G,{children:"Create a new user account with appropriate roles and permissions."})]}),e.jsxs("form",{onSubmit:y(S),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"full_name",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Full Name"]}),e.jsx(D,{id:"full_name",placeholder:"Enter full name",...c("full_name",{required:"Full name is required",minLength:{value:2,message:"Name must be at least 2 characters"}}),className:r.full_name?"border-red-500":""}),r.full_name&&e.jsx("p",{className:"text-sm text-red-600",children:r.full_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Email Address"]}),e.jsx(D,{id:"email",type:"email",placeholder:"user@company.com",...c("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"},onChange:t=>C(t.target.value)}),className:r.email?"border-red-500":""}),r.email&&e.jsx("p",{className:"text-sm text-red-600",children:r.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"username",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Username"]}),e.jsx(D,{id:"username",placeholder:"Auto-generated from email",...c("username",{required:"Username is required",minLength:{value:3,message:"Username must be at least 3 characters"}}),className:r.username?"border-red-500":""}),r.username&&e.jsx("p",{className:"text-sm text-red-600",children:r.username.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"password",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Temporary Password"]}),e.jsx(D,{id:"password",type:"password",placeholder:"Enter temporary password",...c("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:r.password?"border-red-500":""}),r.password&&e.jsx("p",{className:"text-sm text-red-600",children:r.password.message}),e.jsx("p",{className:"text-xs text-gray-500",children:"User will be prompted to change password on first login"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Role & Permissions"]}),e.jsxs(X,{value:b,onValueChange:t=>p("role",t),children:[e.jsx(J,{children:e.jsx(Y,{placeholder:"Select user role"})}),e.jsx(Q,{children:U.map(t=>e.jsx(W,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:t.color,className:"text-xs",children:t.label}),e.jsx("span",{className:"text-sm text-gray-600",children:t.description})]})},t.value))})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded",children:[e.jsx(_,{variant:g.color,children:g.label}),e.jsx("span",{className:"text-sm text-gray-600",children:g.description})]})]}),j&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:j})}),e.jsxs(ee,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:h,disabled:u,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Create User"]})})]})]})]})})}const xe=[{value:"Admin",label:"Administrator"},{value:"Analyst",label:"Security Analyst"},{value:"ReadOnly",label:"Read Only"}];function he({open:m,onOpenChange:N,onUsersInvited:d}){const[u,w]=n.useState(!1),[j,i]=n.useState(null),[c,y]=n.useState(""),[l,p]=n.useState([]),[x,r]=n.useState(""),[b,h]=n.useState(""),S=()=>{y(""),p([]),r(""),h(""),i(null),N(!1)},C=()=>{const a=c.trim();a&&g(a)&&!l.includes(a)&&(p([...l,a]),y(""))},U=a=>{p(l.filter(A=>A!==a))},g=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),t=a=>{(a.key==="Enter"||a.key===",")&&(a.preventDefault(),C())},f=async a=>{var A,E;if(a.preventDefault(),l.length===0){i("At least one email address is required");return}if(!x){i("Role selection is required");return}w(!0),i(null);try{const s={emails:l,role:x,message:b.trim()||"You have been invited to join the Aegis Risk Management Platform.",sent_date:new Date().toISOString()};console.log("Sending invitations with data:",s);const P=l.map(I=>z.create({email:I,role:x,status:"Invited",full_name:"",username:I.split("@")[0],invitation_sent:!0,invitation_message:b}));await Promise.all(P),console.log("✅ Invitations sent successfully"),d&&d(),S()}catch(s){console.error("❌ Failed to send invitations:",s),i(((E=(A=s.response)==null?void 0:A.data)==null?void 0:E.message)||s.message||"Failed to send invitations")}finally{w(!1)}};return e.jsx(B,{open:m,onOpenChange:N,children:e.jsxs(H,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Invite Users"]}),e.jsx(G,{children:"Send invitations to new users to join the Aegis Risk Management Platform."})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[j&&e.jsx("div",{className:"bg-destructive/15 text-destructive text-sm p-3 rounded-md",children:j}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"email-input",children:"Email Addresses *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{id:"email-input",type:"email",placeholder:"Enter email address and press Enter",value:c,onChange:a=>y(a.target.value),onKeyPress:t,className:"flex-1"}),e.jsx(o,{type:"button",variant:"outline",onClick:C,disabled:!c.trim()||!g(c.trim()),children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Type email addresses and press Enter or comma to add them"}),l.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-3 border rounded-md bg-muted/20",children:l.map(a=>e.jsxs(_,{variant:"secondary",className:"gap-1",children:[a,e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>U(a),children:e.jsx(le,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"role",children:"Default Role *"}),e.jsxs(X,{value:x,onValueChange:r,required:!0,children:[e.jsx(J,{children:e.jsx(Y,{placeholder:"Select default role for invited users"})}),e.jsx(Q,{children:xe.map(a=>e.jsx(W,{value:a.value,children:a.label},a.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All invited users will be assigned this role initially"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"message",children:"Custom Message (Optional)"}),e.jsx(de,{id:"message",placeholder:"Add a personal message to the invitation email...",value:b,onChange:a=>h(a.target.value),rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This message will be included in the invitation email"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Invitation Process"}),e.jsx("p",{className:"text-blue-700 mt-1",children:'Invited users will receive an email with instructions to set up their account. They will appear in the users list with "Invited" status until they complete registration.'})]})]})})]}),e.jsxs(ee,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:S,children:"Cancel"}),e.jsxs(o,{type:"submit",disabled:u||l.length===0,children:[u&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Send ",l.length>0?`${l.length} `:"","Invitation",l.length!==1?"s":""]})]})]})]})})}function Ne(){const[m,N]=n.useState(""),[d,u]=n.useState([]),[w,j]=n.useState(!0),[i,c]=n.useState(null),[y,l]=n.useState(!1),[p,x]=n.useState(!1),[r,b]=n.useState(!1);n.useEffect(()=>{E()},[]);const h=d.filter(s=>{var P,I,V;return((P=s.full_name)==null?void 0:P.toLowerCase().includes(m.toLowerCase()))||((I=s.email)==null?void 0:I.toLowerCase().includes(m.toLowerCase()))||((V=s.role)==null?void 0:V.toLowerCase().includes(m.toLowerCase()))});if(w)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(oe,{size:"lg"})});const S=s=>{switch(s==null?void 0:s.toLowerCase()){case"active":return"default";case"inactive":return"secondary";case"suspended":return"destructive";default:return"secondary"}},C=s=>{switch(s==null?void 0:s.toLowerCase()){case"admin":return"destructive";case"security analyst":return"secondary";case"risk manager":return"outline";case"compliance officer":return"default";default:return"secondary"}},U=()=>{console.log("Add User clicked - Opening dialog"),l(!0)},g=()=>{console.log("Invite Users clicked - Opening invite dialog"),x(!0)},t=()=>{console.log("Users invited successfully - refreshing user list"),E()},f=()=>{console.log("Filters clicked - Opening filters dialog"),alert("User filters functionality coming soon - would open a filters panel")},a=s=>{console.log("Edit User clicked for user:",s),alert(`User editing functionality coming soon - would open edit dialog for user ${s}`)},A=()=>{console.log("User added successfully - refreshing user list"),E()},E=async()=>{try{j(!0);const s=await z.getAll();u(s.items||[]),c(null)}catch(s){c(s.message||"Failed to fetch users"),console.error("Error fetching users:",s),u([])}finally{j(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8"}),"User Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:g,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Invite Users"]}),e.jsxs(o,{onClick:U,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Add User"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(D,{placeholder:"Search users...",value:m,onChange:s=>N(s.target.value),className:"max-w-sm"})}),e.jsxs(o,{variant:"outline",size:"sm",onClick:f,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),i&&e.jsx(k,{className:"border-destructive",children:e.jsxs(F,{className:"pt-6",children:[e.jsxs("p",{className:"text-destructive",children:["Error: ",i]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Showing example data while backend is unavailable."})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(k,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registered users"})]})]}),e.jsxs(k,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Active Users"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.filter(s=>s.status==="Active").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently active"})]})]}),e.jsxs(k,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Inactive Users"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.filter(s=>s.status!=="Active").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Need attention"})]})]}),e.jsxs(k,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Roles"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(F,{children:[e.jsx("div",{className:"text-2xl font-bold",children:new Set(d.map(s=>s.role)).size}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Different roles"})]})]})]}),e.jsxs(k,{children:[e.jsxs(R,{children:[e.jsxs(L,{children:["Users (",h.length,")"]}),e.jsx(me,{children:"Manage user accounts and access permissions"})]}),e.jsx(F,{children:h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No users found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:m?"Try adjusting your search criteria":"Get started by adding your first user"}),e.jsxs(o,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Add User"]})]}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.full_name}),e.jsx(_,{variant:S(s.status),children:s.status||"Unknown"}),e.jsx(_,{variant:C(s.role),children:s.role||"No Role"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s.email||"No email"}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:e.jsxs("span",{children:["Last Login: ",s.last_login?new Date(s.last_login).toLocaleString():"Never"]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>a(s.id),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Edit"]})})]},s.id))})})]}),e.jsx(ue,{open:y,onOpenChange:l,onUserAdded:A}),e.jsx(he,{open:p,onOpenChange:x,onUsersInvited:t})]})}export{Ne as default};
