import{r,ai as $,j as e,a2 as u,X as q,a1 as P,aY as I,$ as V,J as G}from"./react-vendor-B391mDFM.js";import{D as H,l as W,m as J,n as K,o as X,p as k,B as c,I as R,T as Y,S as Z,q as Q,s as _,t as ee,u as se,F as M,L as te,C as j,a as g,b as C,c as E,d as le,e as O}from"./assessments-CKARqxWC.js";import{A as ae,b as ne}from"./dashboard-BBWRqNEx.js";import"./vendor-BAj2-sgi.js";import"./ui-vendor-BA32w1ww.js";import"./utils-vendor-D-EuUvUy.js";const ie=["Policy","Technical","Training","Administrative","Procedure","Certificate","Report","Other"];function re({open:d,onOpenChange:F,onEvidenceUploaded:o}){const[x,S]=r.useState(!1),[v,i]=r.useState(null),[a,h]=r.useState(null),{register:w,handleSubmit:D,reset:f,setValue:U,formState:{errors:y},watch:N}=$(),T=N("type"),L=t=>{var m;const l=(m=t.target.files)==null?void 0:m[0];if(l&&(h(l),!N("title"))){const p=l.name.replace(/\.[^/.]+$/,"");U("title",p)}},z=t=>{if(t===0)return"0 Bytes";const l=1024,m=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,p)).toFixed(2))+" "+m[p]},A=t=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/csv","image/jpeg","image/png","image/gif"].includes(t.type),B=async t=>{if(!a){i("Please select a file to upload");return}if(!A(a)){i("Invalid file type. Please upload PDF, Word, Excel, text, or image files only.");return}if(a.size>50*1024*1024){i("File size must be less than 50MB");return}try{S(!0),i(null);const l=new FormData;l.append("file",a),l.append("title",t.title),l.append("description",t.description),l.append("type",t.type),await M.upload(l),f(),h(null),F(!1),o&&o(),console.log("Evidence uploaded successfully")}catch(l){console.error("Error uploading evidence:",l),i(l.message||"Failed to upload evidence. Please try again.")}finally{S(!1)}},s=()=>{x||(f(),h(null),i(null),F(!1))},n=()=>{h(null),i(null);const t=document.querySelector('input[type="file"]');t&&(t.value="")};return e.jsx(H,{open:d,onOpenChange:s,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(J,{children:[e.jsx(K,{children:"Upload Evidence"}),e.jsx(X,{children:"Upload compliance evidence and supporting documentation"})]}),e.jsxs("form",{onSubmit:D(B),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"file",children:"File"}),e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center",children:a?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(u,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:z(a.size)})]}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:n,className:"mt-2",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Remove"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-8 w-8 text-muted-foreground mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PDF, Word, Excel, Text, or Image files (max 50MB)"})]}),e.jsx(R,{id:"file",type:"file",onChange:L,accept:".pdf,.doc,.docx,.xls,.xlsx,.txt,.csv,.jpg,.jpeg,.png,.gif",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"title",children:"Title *"}),e.jsx(R,{id:"title",...w("title",{required:"Title is required"}),placeholder:"Enter evidence title"}),y.title&&e.jsx("p",{className:"text-sm text-destructive",children:y.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"description",children:"Description"}),e.jsx(Y,{id:"description",...w("description"),placeholder:"Describe the evidence (optional)",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"type",children:"Type *"}),e.jsxs(Z,{value:T,onValueChange:t=>U("type",t),children:[e.jsx(Q,{children:e.jsx(_,{placeholder:"Select evidence type"})}),e.jsx(ee,{children:ie.map(t=>e.jsx(se,{value:t,children:t},t))})]}),y.type&&e.jsx("p",{className:"text-sm text-destructive",children:"Evidence type is required"})]}),v&&e.jsxs(ae,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(ne,{children:v})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:s,disabled:x,children:"Cancel"}),e.jsx(c,{type:"submit",disabled:x||!a,children:x?"Uploading...":"Upload Evidence"})]})]})]})})}function ue(){const[d,F]=r.useState(""),[o,x]=r.useState([]),[S,v]=r.useState(!0),[i,a]=r.useState(null),[h,w]=r.useState(!1),D=async()=>{try{v(!0);const s=await M.getAll();x(s.items||[]),a(null)}catch(s){a(s.message||"Failed to fetch evidence"),console.error("Error fetching evidence:",s),x([])}finally{v(!1)}};r.useEffect(()=>{D()},[]);const f=o.filter(s=>{var n,t,l;return((n=s.title)==null?void 0:n.toLowerCase().includes(d.toLowerCase()))||((t=s.type)==null?void 0:t.toLowerCase().includes(d.toLowerCase()))||((l=s.description)==null?void 0:l.toLowerCase().includes(d.toLowerCase()))});if(S)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(te,{size:"lg"})});const U=s=>{switch(s==null?void 0:s.toLowerCase()){case"approved":return"default";case"under review":return"secondary";case"pending":return"outline";case"rejected":return"destructive";default:return"outline"}},y=s=>{switch(s==null?void 0:s.toLowerCase()){case"policy":return"default";case"technical":return"secondary";case"training":return"outline";case"administrative":return"secondary";default:return"outline"}},N=()=>{console.log("Upload Evidence clicked - Opening file upload dialog"),w(!0)},T=()=>{console.log("Evidence uploaded successfully - refreshing evidence list"),D()},L=()=>{console.log("Export All clicked - Exporting all evidence files"),alert("Export All functionality would download all evidence files as a ZIP archive")},z=()=>{console.log("Filters clicked - Opening filters dialog"),alert("Filters functionality would open a filters panel for evidence")},A=async s=>{console.log("Download clicked for evidence:",s);try{const n=await M.download(s),t=new Blob([n.data],{type:n.headers["content-type"]||"application/octet-stream"}),l=n.headers["content-disposition"];let m=`evidence-${s}`;l&&l.includes("filename=")&&(m=l.split("filename=")[1].replace(/['"]/g,""));const p=window.URL.createObjectURL(t),b=document.createElement("a");b.href=p,b.download=m,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(p),console.log(`Evidence ${s} downloaded successfully`)}catch(n){console.error("Error downloading evidence:",n),alert(`Failed to download evidence: ${n.message||"Unknown error"}`)}},B=s=>{console.log("View Details clicked for evidence:",s),alert(`View Details functionality would show detailed view for evidence ${s}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(u,{className:"h-8 w-8"}),"Evidence Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage compliance evidence and supporting documentation"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:L,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Export All"]}),e.jsxs(c,{onClick:N,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Upload Evidence"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(R,{placeholder:"Search evidence...",value:d,onChange:s=>F(s.target.value),className:"max-w-sm"})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:z,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),i&&e.jsx(j,{className:"border-destructive",children:e.jsxs(g,{className:"pt-6",children:[e.jsxs("p",{className:"text-destructive",children:["Error: ",i]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Showing demo data while backend is unavailable."})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(j,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Total Evidence"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Files in repository"})]})]}),e.jsxs(j,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Approved"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.filter(s=>s.status==="Approved").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for audit"})]})]}),e.jsxs(j,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Under Review"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.filter(s=>s.status==="Under Review").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending approval"})]})]}),e.jsxs(j,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Evidence Types"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:new Set(o.map(s=>s.type)).size}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Different categories"})]})]})]}),e.jsxs(j,{children:[e.jsxs(C,{children:[e.jsxs(E,{children:["Evidence (",f.length,")"]}),e.jsx(le,{children:"Compliance evidence and supporting documentation"})]}),e.jsx(g,{children:f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(u,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No evidence found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:d?"Try adjusting your search criteria":"Get started by uploading your first evidence file"}),e.jsxs(c,{onClick:N,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Upload Evidence"]})]}):e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx(O,{variant:U(s.status),children:s.status||"Unknown"}),e.jsx(O,{variant:y(s.type),children:s.type||"Unknown"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s.description||"No description available"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Size: ",s.size||"Unknown"]}),s.uploaded&&e.jsxs("span",{children:["Uploaded: ",new Date(s.uploaded).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>A(s.id),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>B(s.id),children:"View Details"})]})]},s.id))})})]}),e.jsx(re,{open:h,onOpenChange:w,onEvidenceUploaded:T})]})}export{ue as default};
